<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Info Bar</title>
  <style>
    body { margin: 0; padding: 0; background: transparent; }
    #info-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 16px;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      font-size: 1rem;
      padding: 8px 24px;
      white-space: nowrap;
    }
    .info-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .blinking {
      animation: blink 1s step-start 0s infinite;
    }
    @keyframes blink {
      50% { opacity: 0.2; }
    }
    .battery-bar {
      display: inline-block;
      width: 32px;
      height: 12px;
      border: 1px solid #ccc;
      background: #222;
      position: relative;
    }
    .battery-fill {
      height: 100%;
      transition: width 0.5s ease;
    }
    .gps-bars, .network-bars {
      display: inline-flex;
      align-items: flex-end;
      gap: 3px;
    }
    .bar {
      width: 3px;
      background: #60a5fa;
      opacity: 0.4;
      transition: height 0.3s, opacity 0.3s, background 0.3s;
    }
    .bar.on { opacity: 1; }
    .bar1 { height: 5px; }
    .bar2 { height: 9px; }
    .bar3 { height: 13px; }
    .bar4 { height: 17px; }
    .bar5 { height: 21px; }
    #uplogo {
      font-weight: 700;
      font-size: 1.4rem;
      color: #ec0b8d;
      font-family: 'Arial Black', Arial, sans-serif;
      user-select: none;
    }
    #gps-label {
      font-weight: bold;
    }
    @media screen and (max-width: 480px) {
      #info-bar { font-size: 0.9rem; flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <div id="info-bar">
    <div class="info-item" id="uplogo">U+</div>
    <div class="info-item"><span id="time">-</span></div>
    <div class="info-item">üõµ <span id="distance">0.00</span>km</div>
    <div class="info-item">üå°Ô∏è <span id="temp">-</span>¬∞C</div>
    <div class="info-item">‚òÅÔ∏è <span id="desc">-</span></div>
    <div class="info-item">üå¨Ô∏è <span id="wind">-</span> m/s</div>
    <div class="info-item" id="gps-label">GPS</div>
    <div class="info-item"><span id="network-status">4G</span></div>
    <div class="info-item">
      <div class="network-bars">
        <div class="bar bar1" id="net1"></div>
        <div class="bar bar2" id="net2"></div>
        <div class="bar bar3" id="net3"></div>
        <div class="bar bar4" id="net4"></div>
        <div class="bar bar5" id="net5"></div>
      </div>
    </div>
    <div class="info-item">
      <span id="battery">-</span>%
      <div class="battery-bar">
        <div id="battery-fill" class="battery-fill"></div>
      </div>
    </div>
    <div class="info-item blinking">üî¥ Live</div>
  </div>

  <script>
    function updateTime() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      const ap = h >= 12 ? 'Ïò§ÌõÑ' : 'Ïò§Ï†Ñ';
      const hh = (h % 12 || 12).toString();
      document.getElementById('time').textContent = `${ap} ${hh}:${m}`;
    }

    function updateSignalBars(strength) {
      const level = parseInt(strength || 0);

      for (let i = 1; i <= 5; i++) {
        const bar = document.getElementById('net' + i);
        bar.classList.remove('on', 'blinking');
        bar.style.background = '#ccc'; // Í∏∞Î≥∏ ÌöåÏÉâÏúºÎ°ú Ï¥àÍ∏∞Ìôî
      }

      for (let i = 1; i <= 5; i++) {
        const bar = document.getElementById('net' + i);

        if (i <= level) {
          bar.classList.add('on');

          if (level === 1) {
            bar.style.background = '#f87171'; // Îπ®Í∞ï + ÍπúÎ∞ïÏûÑ
            bar.classList.add('blinking');
          } else if (level === 2) {
            bar.style.background = '#f87171'; // Îπ®Í∞ï Í≥†Ï†ï
          } else {
            bar.style.background = '#4ade80'; // Ï¥àÎ°ù Í≥†Ï†ï
          }
        }
      }
    }

    function updateGpsLabel(accuracy) {
      const acc = parseFloat(accuracy);
      const gpsLabel = document.getElementById('gps-label');
      gpsLabel.classList.remove('blinking');
      if (acc <= 20) {
        gpsLabel.style.color = '#4ade80';
      } else if (acc <= 50) {
        gpsLabel.style.color = '#4ade80';
        gpsLabel.classList.add('blinking');
      } else {
        gpsLabel.style.color = '#f87171';
        gpsLabel.classList.add('blinking');
      }
    }

    async function fetchData() {
      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbxpKvbE7y7NQXplZR3LuGjQBcvX44ywsKKADsmQOUnNN3ICC0UABbaVmCtlWzlgu-vM5A/exec");
        const data = await res.json();

        const battery = parseInt(data.battery || 0);
        const battFill = document.getElementById('battery-fill');
        document.getElementById('battery').textContent = battery;
        battFill.style.width = `${Math.min(battery, 100)}%`;
        battFill.classList.remove('blinking');

        if (battery <= 30) {
          battFill.style.background = '#f87171';
          battFill.classList.add('blinking');
        } else if (battery <= 50) {
          battFill.style.background = '#facc15';
        } else {
          battFill.style.background = '#4ade80';
        }

        document.getElementById('temp').textContent = data.temp ?? '-';
        document.getElementById('desc').textContent = data.desc ?? '-';
        document.getElementById('wind').textContent = data.wind ?? '-';
        document.getElementById('distance').textContent = parseFloat(data.total_km || 0).toFixed(2);
        document.getElementById('network-status').textContent = data.network || '4G';

        updateSignalBars(data.network_strength);
        updateGpsLabel(data.accuracy);
      } catch (e) {
        console.error('fetch error:', e);
      }
    }

    updateTime();
    setInterval(updateTime, 1000);
    fetchData();
    setInterval(fetchData, 3000);
  </script>
</body>
</html>
