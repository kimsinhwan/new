<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Info Bar</title>
  <style>
    /* ▶(기존 스타일 그대로) */
    body{margin:0;padding:0;background:transparent;}
    #info-bar{display:flex;justify-content:flex-start;align-items:center;gap:16px;
      background:rgba(0,0,0,.85);color:#fff;font-size:1rem;padding:8px 24px;white-space:nowrap;}
    .info-item{display:inline-flex;align-items:center;gap:4px;}
    .blinking{animation:blink 1s step-start 0s infinite;}
    @keyframes blink{50%{opacity:.2;}}
    .battery-bar{display:inline-block;width:32px;height:12px;border:1px solid #ccc;background:#222;}
    .battery-fill{height:100%;transition:width .5s ease;}
    .gps-bars,.network-bars{display:inline-flex;align-items:flex-end;gap:3px;}
    .bar{width:3px;background:#60a5fa;opacity:.4;transition:height .3s,opacity .3s,background .3s;}
    .bar.on{opacity:1;}
    .bar1{height:5px}.bar2{height:9px}.bar3{height:13px}.bar4{height:17px}.bar5{height:21px}
    #uplogo{font-weight:700;font-size:1.4rem;color:#ec0b8d;font-family:'Arial Black',Arial,sans-serif;user-select:none;}
    #gps-label{font-weight:bold;}
    @media screen and (max-width:480px){#info-bar{font-size:.9rem;flex-wrap:wrap;}}
  </style>
</head>
<body>
  <div id="info-bar">
    <div class="info-item" id="uplogo">U+</div>
    <div class="info-item"><span id="time">-</span></div>
    <div class="info-item">🛵 <span id="distance">0.00</span>km</div>
    <div class="info-item">🌡️ <span id="temp">-</span>°C</div>
    <div class="info-item">☁️ <span id="desc">-</span></div>
    <div class="info-item">🌬️ <span id="wind">-</span> m/s</div>
    <div class="info-item" id="gps-label">GPS</div>
    <div class="info-item"><span id="network-status">4G</span></div>
    <div class="info-item">
      <div class="network-bars">
        <div class="bar bar1" id="net1"></div>
        <div class="bar bar2" id="net2"></div>
        <div class="bar bar3" id="net3"></div>
        <div class="bar bar4" id="net4"></div>
        <div class="bar bar5" id="net5"></div>
      </div>
    </div>
    <div class="info-item">
      <span id="battery">-</span>%
      <div class="battery-bar"><div id="battery-fill" class="battery-fill"></div></div>
    </div>
    <div class="info-item blinking">🔴 Live</div>
  </div>

  <script>
    /* 시계 */
    function updateTime(){
      const n=new Date(),h=n.getHours(),m=n.getMinutes().toString().padStart(2,'0');
      const ap=(h>=12?'오후':'오전'),hh=(h%12||12).toString();
      document.getElementById('time').textContent=`${ap} ${hh}:${m}`;
    }

    /* 신호강도·GPS 표시 함수(기존 유지) ... 그대로 ... */

    /* ✅ GAS URL (googleusercontent 직통) */
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxpKvbE7y7NQXplZR3LuGjQBcvX44ywsKKADsmQOUnNN3ICC0UABbaVmCtlWzlgu-vM5A/exec';

    async function fetchData(){
      try{
        const res = await fetch(GAS_URL + '&t=' + Date.now(), { cache:'no-store' });
        const d   = await res.json();

        /* 기존 데이터 바인딩 로직 그대로 (배터리/온도/거리 등) */
        const batt = parseInt(d.battery||0);
        document.getElementById('battery').textContent = batt;
        const fill = document.getElementById('battery-fill');
        fill.style.width = `${Math.min(batt,100)}%`;
        fill.classList.remove('blinking');
        /* ... 이하 기존 로직 그대로 ... */
        document.getElementById('temp').textContent  = d.temp  ?? '-';
        document.getElementById('desc').textContent  = d.desc  ?? '-';
        document.getElementById('wind').textContent  = d.wind  ?? '-';
        document.getElementById('distance').textContent =
          parseFloat(d.total_km||0).toFixed(2);
        document.getElementById('network-status').textContent = d.network||'4G';
        updateSignalBars(d.network_strength);
        updateGpsLabel(d.accuracy);
      }catch(e){ console.error('fetch error:',e); }
    }

    updateTime();               /* 시계 1초 주기 */
    setInterval(updateTime,1000);
    fetchData();                /* 데이터 3초 주기 */
    setInterval(fetchData,3000);
  </script>
</body>
</html>
