<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Info Bar</title>
  <style>
    body { margin: 0; padding: 0; background: transparent; }

    #info-bar {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 16px;
      background: rgba(0, 0, 0, 0.85);
      color: white;
      font-size: 1rem;
      padding: 8px 24px;
      white-space: nowrap;
    }

    .info-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .blinking {
      animation: blink 1s step-start 0s infinite;
      color: #f87171;
    }

    @keyframes blink {
      50% { opacity: 0.2; }
    }

    .battery-bar {
      display: inline-block;
      width: 32px;
      height: 12px;
      border: 1px solid #ccc;
      background: #222;
      position: relative;
    }

    .battery-fill {
      height: 100%;
      background: #4ade80;
      transition: width 0.5s ease;
    }

    .gps-antenna {
      display: inline-flex;
      align-items: flex-end;
      gap: 2px;
      margin-right: 4px;
    }

    .antenna-bar {
      width: 3px;
      background: #444;
      transition: height 0.3s, background 0.3s;
    }

    .antenna1 { height: 6px; }
    .antenna2 { height: 10px; }
    .antenna3 { height: 14px; }
    .antenna-on { background: #4ade80; }
    .antenna-blink { background: #f87171 !important; animation: blink 1s step-start 0s infinite; }

    .gps-bars, .network-bars {
      display: inline-flex;
      align-items: flex-end;
      gap: 3px;
    }

    .bar {
      width: 3px;
      background: #60a5fa;
      opacity: 0.4;
      transition: height 0.3s, opacity 0.3s, background 0.3s;
    }

    .bar.on { opacity: 1; }
    .bar1 { height: 5px; }
    .bar2 { height: 9px; }
    .bar3 { height: 13px; }
    .bar4 { height: 17px; }
    .bar5 { height: 21px; }

    #uplogo {
      font-weight: 700;
      font-size: 1.4rem;
      color: #ec0b8d;
      font-family: 'Arial Black', Arial, sans-serif;
      user-select: none;
      cursor: default;
    }

    @media screen and (max-width: 480px) {
      #info-bar { font-size: 0.9rem; flex-wrap: wrap; }
    }
  </style>
</head>
<body>
  <div id="info-bar">
    <div class="info-item" id="uplogo">U+</div>
    <div class="info-item">
      <div class="gps-antenna">
        <div class="antenna-bar antenna1" id="antenna1"></div>
        <div class="antenna-bar antenna2" id="antenna2"></div>
        <div class="antenna-bar antenna3" id="antenna3"></div>
      </div>
      <span id="network-status">4G</span>
    </div>
    <div class="info-item"><span id="time">-</span></div>
    <div class="info-item">üõµ <span id="distance">0.00</span>km</div>
    <div class="info-item">üå°Ô∏è <span id="temp">-</span>¬∞C</div>
    <div class="info-item">‚òÅÔ∏è <span id="desc">-</span></div>
    <div class="info-item">üå¨Ô∏è <span id="wind">-</span> m/s</div>
    <div class="info-item">
      <div class="gps-bars">
        <div class="bar bar1" id="net1"></div>
        <div class="bar bar2" id="net2"></div>
        <div class="bar bar3" id="net3"></div>
        <div class="bar bar4" id="net4"></div>
        <div class="bar bar5" id="net5"></div>
      </div>
    </div>
    <div class="info-item">
      <span id="battery">-</span>%
      <div class="battery-bar"><div id="battery-fill" class="battery-fill"></div></div>
    </div>
    <div class="info-item blinking">üî¥ Live</div>
  </div>

  <script>
    function updateTime() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      const ap = h >= 12 ? 'Ïò§ÌõÑ' : 'Ïò§Ï†Ñ';
      const hh = (h % 12 || 12).toString();
      document.getElementById('time').textContent = `${ap} ${hh}:${m}`;
    }

    function updateGpsAntennaBars(accuracy) {
      const acc = parseFloat(accuracy);
      for (let i = 1; i <= 3; i++) {
        const el = document.getElementById('antenna' + i);
        el.classList.remove('antenna-on', 'antenna-blink');
      }

      if (acc <= 10) {
        for (let i = 1; i <= 3; i++) {
          document.getElementById('antenna' + i).classList.add('antenna-on');
        }
      } else if (acc <= 19) {
        for (let i = 1; i <= 2; i++) {
          document.getElementById('antenna' + i).classList.add('antenna-on', 'antenna-blink');
        }
      } else {
        document.getElementById('antenna1').classList.add('antenna-blink');
      }
    }

    function updateSignalBars(strength) {
      const level = parseInt(strength || 0);
      for (let i = 1; i <= 5; i++) {
        const bar = document.getElementById('net' + i);
        if (i <= level) {
          bar.classList.add('on');
          bar.style.background = i <= 2 ? '#f87171' : '#4ade80';
        } else {
          bar.classList.remove('on');
          bar.style.background = '#60a5fa';
        }
      }
    }

    async function fetchData() {
      try {
        const res = await fetch('https://script.google.com/macros/s/AKfycbxTLvLP69RaNDT17z2Jcgan_qwxWcOBHNvackXvqdqrvGeHOZ4TZXO1o7v0ZDBDPI6I8Q/exec');
        const data = await res.json();

        document.getElementById('battery').textContent = data.battery ?? '-';
        document.getElementById('temp').textContent = data.temp ?? '-';
        document.getElementById('desc').textContent = data.desc ?? '-';
        document.getElementById('wind').textContent = data.wind ?? '-';
        document.getElementById('distance').textContent = parseFloat(data.total_km || 0).toFixed(2);

        const battFill = document.getElementById('battery-fill');
        const battPercent = parseInt(data.battery || 0);
        battFill.style.width = `${Math.min(battPercent, 100)}%`;

        updateGpsAntennaBars(data.accuracy);
        updateSignalBars(data.network_strength);
      } catch (e) {
        console.error('fetch error:', e);
      }
    }

    updateTime();
    setInterval(updateTime, 1000);
    fetchData();
    setInterval(fetchData, 5000);
  </script>
</body>
</html>