<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Info Bar</title>
  <style>
    body{margin:0;padding:0;background:transparent;}
    #info-bar{display:flex;justify-content:flex-start;align-items:center;gap:16px;
      background:rgba(0,0,0,.85);color:#fff;font-size:1rem;padding:8px 24px;white-space:nowrap;}
    .info-item{display:inline-flex;align-items:center;gap:4px;}
    .blinking{animation:blink 1s step-start 0s infinite;}
    @keyframes blink{50%{opacity:.2;}}
    .battery-bar{display:inline-block;width:32px;height:12px;border:1px solid #ccc;background:#222;}
    .battery-fill{height:100%;transition:width .5s ease;}
    .gps-bars,.network-bars{display:inline-flex;align-items:flex-end;gap:3px;}
    .bar{width:3px;background:#60a5fa;opacity:.4;transition:height .3s,opacity .3s,background .3s;}
    .bar.on{opacity:1;}
    .bar1{height:5px}.bar2{height:9px}.bar3{height:13px}.bar4{height:17px}.bar5{height:21px}
    #uplogo{font-weight:700;font-size:1.4rem;color:#ec0b8d;font-family:'Arial Black',Arial,sans-serif;user-select:none;}
    #gps-label{font-weight:bold;}
    @media screen and (max-width:480px){#info-bar{font-size:.9rem;flex-wrap:wrap;}}
  </style>
</head>
<body>
  <div id="info-bar">
    <div class="info-item" id="uplogo">U+</div>
    <div class="info-item"><span id="time">-</span></div>
    <div class="info-item">🛵 <span id="distance">0.00</span>km</div>
    <div class="info-item">🌡️ <span id="temp">-</span>°C</div>
    <div class="info-item">☁️ <span id="desc">-</span></div>
    <div class="info-item">🌬️ <span id="wind">-</span> m/s</div>
    <div class="info-item" id="gps-label">GPS</div>
    <div class="info-item"><span id="network-status">4G</span></div>
    <div class="info-item">
      <div class="network-bars">
        <div class="bar bar1" id="net1"></div>
        <div class="bar bar2" id="net2"></div>
        <div class="bar bar3" id="net3"></div>
        <div class="bar bar4" id="net4"></div>
        <div class="bar bar5" id="net5"></div>
      </div>
    </div>
    <div class="info-item">
      <span id="battery">-</span>%
      <div class="battery-bar"><div id="battery-fill" class="battery-fill"></div></div>
    </div>
    <div class="info-item blinking">🔴 Live</div>
  </div>

  <script>
    /* ── 시계 ── */
    function updateTime(){
      const n=new Date(),h=n.getHours(),m=n.getMinutes().toString().padStart(2,'0');
      const ap=(h>=12?'오후':'오전'),hh=(h%12||12).toString();
      document.getElementById('time').textContent=`${ap} ${hh}:${m}`;
    }

    /* ── 신호·GPS ── */
    function updateSignalBars(lvl){
      lvl=parseInt(lvl||0);
      for(let i=1;i<=5;i++){
        const b=document.getElementById('net'+i);
        b.className='bar bar'+i; b.style.background='#ccc';
      }
      for(let i=1;i<=lvl;i++){
        const b=document.getElementById('net'+i); b.classList.add('on');
        if(lvl===1){b.style.background='#f87171';b.classList.add('blinking');}
        else if(lvl===2){b.style.background='#f87171';}
        else{b.style.background='#4ade80';}
      }
    }
    function updateGpsLabel(acc){
      const a=parseFloat(acc),lbl=document.getElementById('gps-label');
      lbl.classList.remove('blinking');
      if(a<=20){lbl.style.color='#4ade80';}
      else if(a<=50){lbl.style.color='#4ade80';lbl.classList.add('blinking');}
      else{lbl.style.color='#f87171';lbl.classList.add('blinking');}
    }

    /* ── GAS 직통 URL ── */
    const GAS_URL='https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLin4SU4LV1fYcDCJ1H0ywD5Kqhgjrxgjh_acvP_NvPBQe71EDEpD5wAFZCzAxWkxqBcc1kfe3ugzoOoj46RnS78G8W1d-EQZNZqLHt6QWKioKDFRBwG4VVnll87wACygEcfnA-jTUKKCKLrK7-6GYmTONpODBo5Fb_XVOZhI1cinFLocHb1xlyFUd-YWkIByc0s_N2ITEouhwNaaZTE3cwsav484tJwHmO16KcSkRq7pGGfdtbosKd9OtlTobiu0YZjEWPLxmEwIdybNDE5Infm8rApqg8Nm31iSSWH&lib=MaUb5hewtBvtrgPuyvD2uPa1JmI-rTja0';

    async function fetchData(){
      try{
        const res = await fetch(GAS_URL + '&t=' + Date.now(), { cache:'no-store' });
        const d   = await res.json();

        const batt=parseInt(d.battery||0);
        document.getElementById('battery').textContent=batt;
        const fill=document.getElementById('battery-fill');
        fill.style.width=`${Math.min(batt,100)}%`; fill.classList.remove('blinking');
        if(batt<=30){fill.style.background='#f87171';fill.classList.add('blinking');}
        else if(batt<=50){fill.style.background='#facc15';}
        else{fill.style.background='#4ade80';}

        document.getElementById('temp').textContent     = d.temp  ?? '-';
        document.getElementById('desc').textContent     = d.desc  ?? '-';
        document.getElementById('wind').textContent     = d.wind  ?? '-';
        document.getElementById('distance').textContent = (+d.total_km||0).toFixed(2);
        document.getElementById('network-status').textContent = d.network||'4G';

        updateSignalBars(d.network_strength);
        updateGpsLabel(d.accuracy);
      }catch(e){console.error('fetch error:',e);}
    }

    updateTime(); setInterval(updateTime,1000);
    fetchData();  setInterval(fetchData,3000);
  </script>
</body>
</html>
